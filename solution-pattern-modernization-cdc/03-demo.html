<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Solution Pattern: Using Change Data Capture for Stack Modernization :: Solution Patterns for Cloud Native Architectures</title>
    <link rel="canonical" href="https://redhat-solution-patterns.github.io/solution-pattern-modernization-cdc/solution-pattern-modernization-cdc/03-demo.html">
    <link rel="prev" href="02-architecture.html">
    <link rel="next" href="#04-workshop.adoc">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EFPESFY3D2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EFPESFY3D2');
</script>  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://redhat.com" target="_blank"><img
          src="../_/img/logo.png" height="40px" alt="Cloud Native Architecture Solution Patterns"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-solution-patterns.github.io/solution-pattern-modernization-cdc">Solution Patterns for Cloud Native Architectures</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">

       
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Solution Patterns</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Adopt Change Data Capture for <br/>stack modernization</a>
            <a class="navbar-item" href="#">Edge-to-Cloud Pipelines</a>     <a class="navbar-item" href="#">Event driven architecture</a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Other</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-gitops-patterns.io/">GitOps Solution Patterns</a>
            <a class="navbar-item" href="https://hybrid-cloud-patterns.io/">Hybrid Cloud Solution Patterns</a>
          </div>
        </div>

        <a class="navbar-item" target="_blank" href="https://www.redhat.com/en/products/middleware">Red Hat Application Services</a>

        <a class="navbar-item" target="_blank" href="https://developers.redhat.com/middleware">Learn more</a>

      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="solution-pattern-modernization-cdc" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Adopting Change Data Capture for stack modernization</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">1. Home page</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#use-cases">1.1 Use cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_content_overview">1.2 Content Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-pattern.html#_story">1.3 The story behind this solution pattern</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-pattern.html#_solution">1.4 The solution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_content_overview">1.5 Explore more solution patterns</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-architecture.html">2. Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#challenges">2.1. Common challenges</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#tech_stack">2.2. Technology stack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-architecture.html#in_depth">2.3. An in-depth look at the solution&#8217;s architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="02-architecture.html#scenario-cashback-wallet">2.3.1 Scenario: Cashback Wallet</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="02-architecture.html#scenario-search">2.3.2 Scenario: Full-text search for data in legacy database</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-demo.html">3. See the Solution in Action</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#demo_desc">3.1. Demonstration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#run_demo">3.2. Run this demonstration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#pre_reqs_demo">3.3. Before getting started</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#install_demo">3.4. Installing the demo</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#walthrough_demo">3.5. Walkthrough guide</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#04-workshop.adoc">4. Workshop</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#04-workshop.adoc#install_wksp">4.1. Installing the workshop environment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#04-workshop.adoc#pre_reqs_wksp">4.2. Before getting started</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#04-workshop.adoc#install_wksp_details">4.3. Installing the environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#04-workshop.adoc#deliver_wksp">4.4. Delivering the workshop</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://redhat-solution-patterns.github.io/">5. Other Red Hat Solution Patterns</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Adopting Change Data Capture for stack modernization</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Adopting Change Data Capture for stack modernization</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Adopting Change Data Capture for stack modernization</a></li>
    <li><a href="03-demo.html">3. See the Solution in Action</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-solution-patterns/solution-pattern-modernization-cdc/edit/master/documentation/modules/ROOT/pages/03-demo.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Solution Pattern: Using Change Data Capture for Stack Modernization</h1>
<h1 id="_see_the_solution_in_action" class="sect0"><a class="anchor" href="#_see_the_solution_in_action"></a><a class="link" href="#_see_the_solution_in_action">See the Solution in Action</a></h1>
<div class="openblock partintro">
<div class="content">
This section brings information about the implementation of the solution pattern, how you can install it, try it out and check the details of the implementation with an actual running application.
</div>
</div>
<div class="sect1">
<h2 id="_run_this_demonstration"><a class="anchor" href="#_run_this_demonstration"></a><a class="link" href="#_run_this_demonstration">1. Run this demonstration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before getting started, here are some key information around this solution pattern demo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Most part of the solution runs on OpenShift, except for Kafka;</p>
</li>
<li>
<p>This hybrid cloud solution includes services integration through <a href="https://red.ht/TryKafka">OpenShift Streams for Apache Kafka</a>. It is a free managed Kafka service offered by Red Hat and  can be used by everyone.</p>
</li>
<li>
<p>The provisioned retail database (simulates the legacy service) is pre-populated with data for customers and products, but no cashback data is pre-populated;</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_pre_requisites"><a class="anchor" href="#_pre_requisites"></a><a class="link" href="#_pre_requisites">1.1. Pre-requisites:</a></h3>
<div class="paragraph">
<p>To run this solution, you will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access to an OpenShift cluster (version &gt;= 4.9) with <em>cluster-admin</em> privileges</p>
</li>
<li>
<p><code>oc</code> OpenShift CLI installed</p>
</li>
<li>
<p>Logged in into the OpenShift cluster with <code>oc</code> as <em>cluster-admin</em></p>
</li>
<li>
<p>Ansible - the playbook was tested with version 2.9</p>
</li>
<li>
<p>Ansible <code>kubernetes.core</code> module.</p>
<div class="paragraph">
<p>This module can be installed with <code>ansible-galaxy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ ansible-galaxy collection install kubernetes.core</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_preparing_your_managed_kafka"><a class="anchor" href="#_preparing_your_managed_kafka"></a><a class="link" href="#_preparing_your_managed_kafka">1.1.1. Preparing your Managed Kafka</a></h4>
<div class="paragraph">
<p>Before moving ahead to the steps of provisioning the services within your OpenShift cluster, first you should provision and configure your Kafka instance.</p>
</div>
<div class="paragraph">
<p>INFO: For detailed instructions on provisioning and configuration of your managed Kafka instance, please check  <a href="https://redhat-scholars.github.io/managed-kafka-workshop/managed-kafka-workshop/main/index.html">this page</a>.</p>
</div>
<div class="paragraph">
<p>Short instructions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to [console.redhat.com](<a href="https://console.redhat.com" class="bare">https://console.redhat.com</a>) and log in with your Red Hat Account ID;</p>
</li>
<li>
<p>On the [console.redhat.com](<a href="https://console.redhat.com" class="bare">https://console.redhat.com</a>) landing page, select <strong>Application Services &#8594; Streams for Apache Kafka &#8594; Kafka instances</strong>;</p>
</li>
<li>
<p>Create a new Kafka instance;</p>
</li>
<li>
<p>Create a new Service Account to connect to your Kafka instance;</p>
<div class="ulist">
<ul>
<li>
<p><strong>IMPORTANT</strong>: Take note of the service account id and password, you&#8217;ll need both information during the provisioning.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configure the ACL for your Service Account. The Service Account should have the following permissions:</p>
<div class="ulist">
<ul>
<li>
<p><code>read</code>, <code>write</code>, <code>create</code> permissions for all topics</p>
</li>
<li>
<p><code>read</code> permissions for all consumer groups</p>
</li>
<li>
<p>If you have <code>rhosak</code> CLI installed, you can execute the following commands to login to the service, select your kafka instance and add the proper configuration, <strong>replacing <code>srvc-acct-9999</code> with your service client id</strong>:</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ssh hljs" data-lang="ssh">$ rhoas login
$ rhoas kafka list
$ rhoas kafka use
$ rhoas kafka acl grant-access --producer --consumer --service-account srvc-acct-9999 --topic all --group all -y</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the following topics:</p>
<div class="ulist">
<ul>
<li>
<p><code>retail.sale-aggregated</code>, with 1 partition</p>
</li>
<li>
<p><code>retail.expense-event</code>, with 1 partition</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_demo"><a class="anchor" href="#_installing_the_demo"></a><a class="link" href="#_installing_the_demo">1.2. Installing the demo</a></h3>
<div class="paragraph">
<p>This solution pattern offers an easy installation process through ansible automation and helm charts. To get your environment up and running, follow the steps below:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clone the repository below to your workstation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ git clone https://github.com/solution-pattern-cdc/ansible.git
$ cd ansible</code></pre>
</div>
</div>
</li>
<li>
<p>Copy the <code>inventories/inventory.template</code> file to <code>inventories/inventory</code>;</p>
</li>
<li>
<p>In the <code>inventories/inventory</code> file, provide the connection details for your Kafka instance:</p>
<div class="ulist">
<ul>
<li>
<p><strong>rhosak_bootstrap_server</strong>: Bootstrap server of your managed Kafka instance;</p>
</li>
<li>
<p><strong>rhosak_service_account_client_id</strong>: Client ID of your Service Account;</p>
</li>
<li>
<p><strong>rhosak_service_account_client_secret</strong>: Client Secret of your Service Account;</p>
</li>
</ul>
</div>
</li>
<li>
<p>Run the Ansible playbook:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ ansible-playbook -i inventories/inventory playbooks/install.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the playbook finished successfully, you should be able to see the different components of the demo installed in the <code>retail</code> namespace on your OpenShift cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_walkthrough_guide"><a class="anchor" href="#_walkthrough_guide"></a><a class="link" href="#_walkthrough_guide">1.3. Walkthrough guide</a></h3>
<div class="paragraph">
<p>A retail store specialized in plants wants to grow its market by expanding in the online market. To do so, they need to start the adoption of new technologies without impacting the existing application that is currently running in production. All information about sales, customers and products are still maintained via legacy application, but this data is also required by the new capabilities.</p>
</div>
<div class="sect3">
<h4 id="_the_environment"><a class="anchor" href="#_the_environment"></a><a class="link" href="#_the_environment">1.3.1. The environment</a></h4>
<div class="paragraph">
<p>To get started, let&#8217;s understand the environment we currently have and take a look at the deployed services.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access your OpenShift console, and using the Administrator view, on the left menu select <strong>Workloads &#8594; Deployments</strong>, or use the <code>oc</code> client to list them:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">$ oc get deployment -n retail</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You should be able to see 11 services deployed:<br></p>
<div class="ulist">
<ul>
<li>
<p><code>cashback-db</code>: PostgreSQL database for cashback related information;</p>
</li>
<li>
<p><code>retail-db</code>: PostgreSQL database used by the legacy services;</p>
</li>
<li>
<p><code>kafka-connect-connect</code>: kafka connectors for database event streaming (debezium);</p>
</li>
<li>
<p><code>cashback-connector</code>: Camel + Quarkus service for event-driven processing of expenses and customers;</p>
</li>
<li>
<p><code>elastic-connector</code>: Camel + Quarkus service for event-driven synchronization of product data with ElasticSearch;</p>
</li>
<li>
<p><code>sales-streams</code>: Quarkus + Kafka Streams event-driven service for purchase data (sales data) aggregation and synchronization;</p>
</li>
<li>
<p><code>cashback-service</code>: Quarkus + Camel event-driven service responsible for calculating and maintaining cashback data up-to-date in the new database;</p>
</li>
<li>
<p><code>cashback-ui</code>: Quarkus + Panache back-end service to facilitate the visualization of cashback information;</p>
</li>
<li>
<p><code>kafdrop</code>: a kafka client ui to facilitate the visualization of events and topics;</p>
</li>
<li>
<p><code>retail-simulation</code>: a Quarkus application that allows simulating a pre-selected number of purchases in the retail database;</p>
</li>
<li>
<p><code>search-service</code>: Quarkus + ElasticSearch extension to simplify the visualization of the indexed data residing in elastic search;</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_components_configuration"><a class="anchor" href="#_components_configuration"></a><a class="link" href="#_components_configuration">Components configuration</a></h5>
<div class="paragraph">
<p>All the customization of the services is externalized using OpenShift secrets. As an example, let&#8217;s check the connection information for the <code>cashback-connector</code> service.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigating to <strong>Workloads &#8594; Deployments &#8594; cashback-connector &#8658; YAML</strong>, the following configuration section can be visualized:</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/03/cashback-connector-deployment-configuration.png" target="_blank" rel="noopener"><img src="_images/03/cashback-connector-deployment-configuration.png" alt="cashback connector deployment configuration" width="100%"></a>
</div>
</div>
</li>
<li>
<p>In order to find out exactly which configuration values are being used by the <code>cashback-connector</code> service, let&#8217;s take a look at the configured secret. On the left menu navigate to <strong>Workloads &#8594; Secrets</strong></p>
</li>
<li>
<p>In the filter, search by the name <code>cashback-connector</code> and select the secret:</p>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/03/cashback-connector-secret.png" target="_blank" rel="noopener"><img src="_images/03/cashback-connector-secret.png" alt="cashback connector secret" width="100%"></a>
</div>
</div>
</li>
<li>
<p>Scroll to the bottom of the page and click on <strong>Reveal values</strong>, located in the Data section.</p>
<div class="ulist">
<ul>
<li>
<p>The parameters you used in your Ansible provisioning inventory was used by Helm charts in order to generate these final values, which are a mix of default template values, plus your custom configuration.</p>
</li>
<li>
<p>This service is configured to:</p>
<div class="ulist">
<ul>
<li>
<p>Connect to the Managed Kafka bootstrap server;</p>
</li>
<li>
<p>Subscribe to the topics <code>retail.sale-aggregated</code> and <code>retail.updates.public.customer</code>;</p>
</li>
<li>
<p>Be a publisher of events on the topic <code>retail.expense-event</code>;</p>
</li>
<li>
<p>Connect to the <code>cashback-db</code>, a postgresql database;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_search_capabilities"><a class="anchor" href="#_search_capabilities"></a><a class="link" href="#_search_capabilities">1.3.2. Search capabilities</a></h4>
<div class="paragraph">
<p><em>Section under development.</em></p>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="02-architecture.html" class="query-params-link">2. Architecture</a></span>
  <span class="next"><a href="#04-workshop.adoc" class="query-params-link">4. Workshop</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <img
          src="../_/img/app-services-logo.png" height="40px" alt="Cloud Native Architecture Solution Patterns"  href="https://redhat.com" ></a>
</footer><script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
